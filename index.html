<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Locations Editor</title>
<style>
  :root { color-scheme: light; }
  * { box-sizing: border-box; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial; background:#f8fafc; color:#111827; }
  .wrap { max-width: 1100px; margin: 32px auto; padding: 16px; }
  .card { border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 2px rgba(0,0,0,.04); background: #fff; }
  .card-header { display:flex; gap:12px; padding:16px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  .title { font-size: 22px; margin:0; }
  .search { position:relative; display:flex; width: 360px; max-width:100%; }
  .search input { width:100%; padding:8px 10px 8px 34px; border:1px solid #e5e7eb; border-radius: 8px; }
  .icon { position:absolute; left:8px; top:50%; transform: translateY(-50%); color:#6b7280; }
  .controls { display:flex; gap:8px; padding:0 16px 12px 16px; align-items:center; flex-wrap:wrap; }
  .controls input[type="text"] { padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; width: 220px; max-width:100%; }
  .btn { display:inline-flex; gap:6px; align-items:center; padding:8px 12px; border:1px solid #e5e7eb; border-radius:8px; background:#f9fafb; cursor:pointer; }
  .btn:hover { background:#f3f4f6; }
  .primary { background:#111827; color:#fff; border-color:#111827; }
  .primary:hover { background:#0b1220; }
  .ghost { background:transparent; border-color:transparent; color:#374151; }
  .danger { border-color:#ef4444; color:#b91c1c; }
  .safe { border-color: #22c55e; color: #15803d; }
  .spacer { flex:1; }
  .sep { border:0; border-top:1px solid #e5e7eb; margin:12px 0; }
  .header-row, .row { display:grid; grid-template-columns: 46px 150px 1fr 130px 130px 120px 140px 200px; gap:10px; padding:8px 16px; align-items:center; }
  .header-row { font-size:12px; text-transform:uppercase; color:#6b7280; font-weight:600; }
  .list { margin:0; padding:0; list-style:none; border-top:1px solid #f3f4f6; }
  .row { border-top:1px solid #f3f4f6; }
  .empty { padding:32px; text-align:center; color:#6b7280; font-size:14px; }
  .badge { display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; }
  .on { background:#e0f2fe; color:#0369a1; }
  .off { background:#f3f4f6; color:#374151; }
  .actions { display:flex; gap:8px; flex-wrap:wrap; }
  .btn-sm { padding:6px 10px; font-size:12px; }
  .footer { display:flex; justify-content:space-between; padding:12px 16px 16px 16px; color:#6b7280; font-size:14px; flex-wrap:wrap; gap:8px; }
  .strong { font-weight:600; color:#111827; }
  .cell-text { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  /* .cell-text { white-space: normal; overflow: visible; text-overflow: unset; word-break: break-word; } */
  .edit-input { width:100%; padding:6px 8px; border:1px solid #e5e7eb; border-radius:8px; height:32px; }
  .switch { position:relative; width:46px; height:24px; display:inline-block; }
  .switch input { opacity:0; width:0; height:0; }
  .slider { position:absolute; cursor:pointer; inset:0; background:#e5e7eb; border-radius:999px; transition:.2s; }
  .slider:before { content:""; position:absolute; height:20px; width:20px; left:2px; top:2px; background:white; border-radius:50%; transition:.2s; box-shadow:0 1px 2px rgba(0,0,0,.1); }
  .switch input:checked + .slider { background:#111827; }
  .switch input:checked + .slider:before { transform: translateX(22px); }
  #toast { position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999; }
  .toast { background:#111827; color:#fff; padding:10px 12px; border-radius:10px; box-shadow:0 4px 16px rgba(0,0,0,.25); font-size:14px; }
  .toast.ok { background:#065f46; }
  .import-area { width:100%; height:120px; padding:8px; border:1px dashed #cbd5e1; border-radius:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#fafafa; }
  @media (max-width: 980px){
    .header-row, .row { grid-template-columns: 36px 140px 1fr 120px 120px 120px 110px 180px; }
  }
  @media (max-width: 860px){
    .header-row, .row { grid-template-columns: 36px 160px 1fr 120px 120px 110px 160px; }
    .col-zip { display:none; }
  }
  @media (max-width: 720px){
    .header-row, .row { grid-template-columns: 36px 160px 1fr 120px 120px 160px; }
    .col-city { display:none; }
  }
  @media (max-width: 640px){
    .header-row, .row { grid-template-columns: 36px 1fr 120px 160px; }
    .col-state, .col-status, .col-actions { display:none; }
  }
  .header-row > div:nth-child(3),
  .row > div:nth-child(3) {
    min-width: 120px;
  }
</style>
</head>
<body>
<section class="wrap">
  <div class="card">
    <header class="card-header">
      <h2 class="title">Locations</h2>
      <div class="search">
        <svg class="icon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M10 18a8 8 0 1 1 5.293-14.293A8 8 0 0 1 10 18Zm11 3-6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="q" type="search" placeholder="Search Jurisdiction" aria-label="Search" />
      </div>
    </header>

    <div class="controls">
      <input id="name" type="text" placeholder=" Jurisdiction name (e.g., chicago)" />
      <input id="street" type="text" placeholder="street_address" />
      <input id="state" type="text" placeholder="state" />
      <input id="city" type="text" placeholder="city" />
      <input id="zip" type="text" placeholder="zip_code" />
      <button id="add" class="btn primary">Add</button>
      <div class="spacer"></div>
      <button id="bulk-on" class="btn">Enable selected</button>
      <button id="bulk-off" class="btn">Disable selected</button>
      <button id="clear" class="btn ghost" hidden>Clear selection</button>
      <button id="export" class="btn">Export JSON</button>
    </div>

    <hr class="sep" />

    <div class="header-row">
      <div><input id="select-all" type="checkbox" aria-label="Select all" /></div>
      <div>Name</div>
      <div>Street Address</div>
      <div class="col-state">State</div>
      <div class="col-city">City</div>
      <div class="col-zip">Zip Code</div>
      <div class="col-status">Status</div>
      <div class="col-actions">Actions</div>
    </div>

    <ul id="list" class="list" role="list"></ul>

    <footer class="footer">
      <div id="counts"></div>
      <div id="selected" hidden>Selected: <span class="strong" id="sel-count">0</span></div>
    </footer>
  </div>
</section>

<div id="toast"></div>

<script>
(() => {
  // ===== Initial data (your array) =====
  const INITIAL_DATA = [
    { "name": "chicago", "street_address": "1111 W 35th St. 5th Floor", "state": "Illinois", "city": "Chicago", "zip_code": "60609", "status" : "0"},
    { "name":"florida", "street_address": "701 Clematis Street, Suite 202", "state": "Florida", "city": "West Palm Beach", "zip_code": "33401-3015", "status" : "0" },
    { "name":"newyork", "street_address": "55 West 46th Street", "state": "New York", "city": "New York", "zip_code": "10036-4120", "status" : "0" },
    { "name": "western_texas", "street_address": "2532 Reunion Blvd", "state": "Texas", "city": "Austin", "zip_code": "78737" , "status" : "0"},
    { "name": "eastern_texas", "street_address": "123 N Main St", "state": "Texas", "city": "Tyler", "zip_code": "75702", "status" : "0" },
    { "name": "western_pennsylvania", "street_address": "10 Timberlane Dr", "state": "Pennsylvania", "city": "Pittsburgh", "zip_code": "15238", "status" : "0" },
    { "name": "northern_georgia", "street_address": "2151 East St NE", "state": "Georgia", "city": "Covington", "zip_code": "30014", "status" : "0" },
    { "name": "middle_florida", "street_address": "720 Sunset Blvd", "state": "Florida", "city": "Kissimmee", "zip_code": "34741", "status" : "0" }
  ];

  // ===== Utilities =====
  const STORAGE_KEY = "locations:v1";
  const uid = () => Math.random().toString(36).slice(2);
  const $ = sel => document.querySelector(sel);

  function toast(msg, ok=false){
    const box = $("#toast");
    const el = document.createElement("div");
    el.className = "toast" + (ok ? " ok" : "");
    el.textContent = msg;
    box.appendChild(el);
    setTimeout(()=>{ el.style.opacity="0"; el.style.transition="opacity .3s"; }, 1800);
    setTimeout(()=> el.remove(), 2300);
  }
  toast.success = m => toast(m, true);

  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      const data = JSON.parse(raw);
      return Array.isArray(data) ? data : null;
    }catch { return null; }
  }
  function save(items){
    try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }catch {}
  }

  // ===== State =====
  let rows = [];        // {id, name, street_address, state, city, zip_code, status: boolean}
  let selected = {};    // id -> true
  let editingId = null; // id currently being edited
  let query = "";

  // ===== Elements =====
  const elQ = $("#q");
  const elName = $("#name");
  const elStreet = $("#street");
  const elState = $("#state");
  const elCity = $("#city");
  const elZip = $("#zip");
  const elAdd = $("#add");
  const elBulkOn = $("#bulk-on");
  const elBulkOff = $("#bulk-off");
  const elClear = $("#clear");
  const elExport = $("#export");
  const elList = $("#list");
  const elCounts = $("#counts");
  const elSelected = $("#selected");
  const elSelCount = $("#sel-count");
  const elSelectAll = $("#select-all");

  // ===== Init =====
  function init(){
    const persisted = load();
    if (persisted) {
      rows = persisted;
    } else {
      // prime with provided data
      rows = INITIAL_DATA.map(x => ({
        id: uid(),
        name: x.name || "",
        street_address: x.street_address || "",
        state: x.state || "",
        city: x.city || "",
        zip_code: x.zip_code || "",
        status: (x.status === "1") // internally boolean
      }));
      save(rows);
    }
    render();
  }

  // ===== Derived =====
  function filtered(){
    const q = query.trim().toLowerCase();
    if (!q) return rows;
    return rows.filter(r =>
      (r.name || "").toLowerCase().includes(q) ||
      (r.street_address || "").toLowerCase().includes(q) ||
      (r.state || "").toLowerCase().includes(q) ||
      (r.city || "").toLowerCase().includes(q) ||
      (r.zip_code || "").toLowerCase().includes(q)
    );
  }
  function selectedIds(){ return Object.keys(selected).filter(id => selected[id]); }

  // ===== Actions =====
  function addRow(){
    const name = (elName.value||"").trim();
    if (!name){ toast("Name is required."); return; }
    const newRow = {
      id: uid(),
      name,
      street_address: elStreet.value||"",
      state: elState.value||"",
      city: elCity.value||"",
      zip_code: elZip.value||"",
      status: true
    };
    rows = [newRow, ...rows];
    save(rows);
    elName.value = ""; elStreet.value = ""; elState.value = ""; elCity.value = ""; elZip.value = "";
    toast.success("Added.");
    render();
  }

  function removeRow(id){
    rows = rows.filter(r => r.id !== id);
    delete selected[id];
    save(rows);
    render();
  }

  function toggleStatus(id, value){
    rows = rows.map(r => r.id === id ? {...r, status: value} : r);
    save(rows);
    // update only badge text if possible (handled in render per-row anyway)
  }

  function startEdit(row){
    editingId = row.id;
    render();
    const firstInput = elList.querySelector(`input[data-e="${row.id}"][data-field="name"]`) ||
                       elList.querySelector(`input[data-e="${row.id}"]`);
    if (firstInput){ firstInput.focus(); firstInput.select && firstInput.select(); }
  }

  function commitEdit(id){
    const inputs = elList.querySelectorAll(`input[data-e="${id}"]`);
    const updated = {};
    inputs.forEach(inp => {
      updated[inp.dataset.field] = inp.value;
    });
    // Minimal validation
    if (!updated.name || !updated.name.trim()){
      toast("Name cannot be empty.");
      return;
    }
    rows = rows.map(r => r.id === id ? {
      ...r,
      name: (updated.name||"").trim(),
      street_address: (updated.street_address||"").trim(),
      state: (updated.state||"").trim(),
      city: (updated.city||"").trim(),
      zip_code: (updated.zip_code||"").trim(),
    } : r);
    editingId = null;
    save(rows);
    toast.success("Saved changes.");
    render();
  }

  function cancelEdit(){
    editingId = null;
    render();
  }

  function bulkSet(val){
    const ids = selectedIds();
    if (ids.length === 0){ toast("Select at least one item first."); return; }
    rows = rows.map(r => selected[r.id] ? {...r, status: val} : r);
    save(rows);
    toast.success(`${val ? "Enabled" : "Disabled"} ${ids.length} ${ids.length===1 ? "location" : "locations"}.`);
    render();
  }

  function clearSelection(){
    selected = {};
    renderSelectionUI();
  }

  function exportJSON(){
    // Convert to your exact schema, with status as "0"/"1"
    const payload = rows.map(r => ({
      name: r.name,
      street_address: r.street_address,
      state: r.state,
      city: r.city,
      zip_code: r.zip_code,
      status: r.status ? "1" : "0"
    }));
    const text = JSON.stringify(payload, null, 2);
    // Copy to clipboard
    if (navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text).then(()=> toast.success("JSON copied to clipboard."));
    }
    // Also trigger download
    const blob = new Blob([text], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "locations.json";
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }

  // ===== Render =====
  function render(){
    const list = $("#list");
    list.innerHTML = "";
    const data = filtered();
    if (data.length === 0){
      const li = document.createElement("li");
      li.className = "empty";
      li.textContent = "No results.";
      list.appendChild(li);
    } else {
      for (const r of data){
        const li = document.createElement("li");
        li.className = "row";

        // checkbox
        const c0 = document.createElement("div");
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!selected[r.id];
        cb.addEventListener("change", e => { selected[r.id] = e.target.checked; renderSelectionUI(); });
        c0.appendChild(cb);

        function textCell(text, className="cell-text"){
          const d = document.createElement("div");
          d.className = className;
          d.textContent = text || "";
          return d;
        }
        function editCell(field, val){
          const d = document.createElement("div");
          const inp = document.createElement("input");
          inp.className = "edit-input";
          inp.value = val || "";
          inp.setAttribute("data-e", r.id);
          inp.setAttribute("data-field", field);
          inp.addEventListener("keydown", e=>{
            if (e.key === "Enter") commitEdit(r.id);
            if (e.key === "Escape") cancelEdit();
          });
          d.appendChild(inp);
          return d;
        }

        const editing = editingId === r.id;

        // name
        li.appendChild(editing ? editCell("name", r.name) : textCell(r.name));

        // street_address
        li.appendChild(editing ? editCell("street_address", r.street_address) : textCell(r.street_address));

        // state
        li.appendChild(editing ? editCell("state", r.state) : textCell(r.state, "cell-text col-state"));

        // city
        li.appendChild(editing ? editCell("city", r.city) : textCell(r.city, "cell-text col-city"));

        // zip_code
        li.appendChild(editing ? editCell("zip_code", r.zip_code) : textCell(r.zip_code, "cell-text col-zip"));

        // status (switch + badge)
        const c6 = document.createElement("div");
        c6.className = "col-status";
        const wrap = document.createElement("div");
        wrap.style.display = "flex"; wrap.style.gap = "8px"; wrap.style.alignItems = "center";

        const lbl = document.createElement("label"); lbl.className = "switch";
        const sw = document.createElement("input"); sw.type = "checkbox"; sw.checked = !!r.status;
        const sld = document.createElement("span"); sld.className = "slider";
        lbl.appendChild(sw); lbl.appendChild(sld);

        const badge = document.createElement("span");
        badge.className = "badge " + (r.status ? "on" : "off");
        badge.textContent = r.status ? "enabled" : "disabled";

        sw.addEventListener("change", e => {
          toggleStatus(r.id, e.target.checked);
          badge.className = "badge " + (e.target.checked ? "on" : "off");
          badge.textContent = e.target.checked ? "enabled" : "disabled";
        });

        wrap.appendChild(lbl); wrap.appendChild(badge);
        c6.appendChild(wrap);
        li.appendChild(c6);

        // actions
        const c7 = document.createElement("div");
        c7.className = "actions col-actions";
        if (!editing) {
          // Show Edit button
          const rename = document.createElement("button");
          rename.className = "btn btn-sm";
          rename.textContent = "Edit";
          rename.addEventListener("click", () => startEdit(r));
          c7.appendChild(rename);

          // Show Remove button ONLY when not editing
          const del = document.createElement("button");
          del.className = "btn btn-sm danger";
          del.textContent = "Remove";
          del.addEventListener("click", () => {
            if (confirm(`Are you sure you want to remove "${r.name}" Jurisdiction?`)) {
              removeRow(r.id);
          }});
          c7.appendChild(del);

        } else {
          // Show Save and Cancel buttons instead
          const saveBtn = document.createElement("button");
          saveBtn.className = "btn btn-sm primary";
          saveBtn.textContent = "Save";
          saveBtn.addEventListener("click", () => commitEdit(r.id));

          const cancelBtn = document.createElement("button");
          cancelBtn.className = "btn btn-sm safe";
          cancelBtn.textContent = "Cancel";
          cancelBtn.addEventListener("click", cancelEdit);

          c7.appendChild(saveBtn);
          c7.appendChild(cancelBtn);
        }
        // prepend the checkbox cell at the very start
        li.prepend(c0);
        li.appendChild(c7);
        elList.appendChild(li);
      }
    }
    renderCounts();
    renderSelectionUI();
  }

  function renderCounts(){
    const total = rows.length;
    const enabled = rows.filter(r=>r.status).length;
    const disabled = total - enabled;
    elCounts.innerHTML = `Total: <span class="strong">${total}</span> • Enabled: ${enabled} • Disabled: ${disabled}`;
  }

  function renderSelectionUI(){
    const data = filtered();
    const all = data.length > 0 && data.every(r => !!selected[r.id]);
    const some = data.some(r => !!selected[r.id]) && !all;
    elSelectAll.checked = all;
    elSelectAll.indeterminate = some;

    const sel = selectedIds().length;
    elSelCount.textContent = sel;
    elSelected.hidden = sel === 0;
    elClear.hidden = sel === 0;
  }

  // ===== Events =====
  elAdd.addEventListener("click", addRow);
  [elName, elStreet, elState, elCity, elZip].forEach(inp => {
    inp.addEventListener("keydown", e => { if (e.key === "Enter") addRow(); });
  });

  elQ.addEventListener("input", e => { query = e.target.value; render(); });

  elBulkOn.addEventListener("click", ()=> bulkSet(true));
  elBulkOff.addEventListener("click", ()=> bulkSet(false));
  elClear.addEventListener("click", clearSelection);
  elExport.addEventListener("click", exportJSON);

  elSelectAll.addEventListener("change", e => {
    const data = filtered();
    const checked = e.target.checked;
    data.forEach(r => {
      selected[r.id] = checked;
    });
    render();
  });
  
  // Boot
  init();
})();
</script>
</body>
</html>
